Object.defineProperties(Math,{degToRad:{value:function(t){return t*this.PI/180}},radToDeg:{value:function(t){return 180*t/this.PI}},isEven:{value:function(t){return!(1&t)}},randRange:{value:function(t,e){return this.random()*(e-t+1)+t}},clamp:{value:function(t,e,a){return this.min(this.max(t,+a),e)}}});class Vec2d{static createFrom(t){if(t instanceof Vec2d)return t;if(t instanceof Array)return new Vec2d(t[0],t[1]);if(t instanceof Object)return new Vec2d(t.x,t.y);throw new Error("Insufficient vector's data")}static getDist(t,e){let a=Vec2d.createFrom(e).sub(Vec2d.createFrom(t));return Math.hypot(a.x,a.y)}constructor(t=0,e=0,a=1){this.x=t,this.y=e,this.w=a,this.o={x:0,y:0,w:1},this.angle=Math.atan2(this.y,this.x),this.length=Math.hypot(this.x,this.y)}add(t){let e=Vec2d.createFrom(t);return new Vec2d(this.x+e.x,this.y+e.y)}sub(t){let e=Vec2d.createFrom(t);return new Vec2d(this.x-e.x,this.y-e.y)}scale(t){return new Vec2d(this.x*t,this.y*t)}addScale(t,e){let a=Vec2d.createFrom(t);return new Vec2d(this.x+a.x*e,this.y+a.y*e)}mult(t){let e=Vec2d.createFrom(t);return new Vec2d(this.x*e.x,this.y*e.y)}dot(t){let e=Vec2d.createFrom(t);return this.x*e.x+this.y*e.y}angleBetween(t){let e=Vec2d.createFrom(t);return this.dot(e)/(this.length*e.length)}getDist(t){let e=Vec2d.createFrom(t).sub(this);return Math.hypot(e.x,e.y)}inverse(){return new Vec2d(1/this.x,1/this.y)}normalise(){return 0!==this.length?this.scale(1/this.length):new Vec2d}getOrthogonal(){let t=90*Math.PI/180+this.angle,e=Math.cos(t),a=Math.sin(t);return new Vec2d(e,a)}applyFunc(t){return new Vec2d(t(this.x),t(this.y))}useNMC(t){let e=Vec3d.createFrom(t);return this.x+=1,this.y+=1,this.x*=e.x,this.y*=e.y,new Vec2d(this.x,this.y,1)}clone(){return new Vec2d(this.x,this.y)}toArray(){return[this.x,this.y]}toObject(){return{x:this.x,y:this.y}}draw(t,e,a=0){t.save(),t.lineWidth=a,t.beginPath(),t.moveTo(this.o.x,this.o.y),t.lineTo(this.o.x+this.x,this.o.y+this.y),t.strokeStyle=e,t.stroke(),t.beginPath(),t.arc(this.o.x+this.x,this.o.y+this.y,3+a,0,2*Math.PI),t.closePath(),t.fillStyle=e,t.fill(),t.restore()}}class Vec3d{static createFrom(t){if(t instanceof Vec3d)return t;if(t instanceof Array)return new Vec3d(t[0],t[1],t[2],1);if(t instanceof Object)return new Vec3d(t.x,t.y,t.z,1);throw new Error("Insufficient vector's data")}static getDist(t,e){let a=Vec3d.createFrom(e).sub(Vec3d.createFrom(t));return Math.hypot(a.x,a.y)}constructor(t=0,e=0,a=0,s=1){this.x=t,this.y=e,this.z=a,this.w=s,this.o={x:0,y:0,z:0,w:1},this.length=Math.hypot(this.x,this.y,this.z)}add(t){let e=Vec3d.createFrom(t);return new Vec3d(this.x+e.x,this.y+e.y,this.z+e.z)}sub(t){let e=Vec3d.createFrom(t);return new Vec3d(this.x-e.x,this.y-e.y,this.z-e.z)}scale(t){return new Vec2d(this.x*t,this.y*t,this.z*t)}addScale(t,e){let a=Vec3d.createFrom(t);return new Vec3d(this.x+a.x*e,this.y+a.y*e,this.z+a.z*e)}mult(t){let e=Vec3d.createFrom(t);return new Vec3d(this.x*e.x,this.y*e.y,this.z*e.z)}dot(t){let e=Vec3d.createFrom(t);return this.x*e.x+this.y*e.y+this.z*e.z}cross(t){let e=Vec3d.createFrom(t),a=this.y*e.z-this.z*e.y,s=this.z*e.x-this.x*e.z,i=this.x*e.y-this.y*e.x;return new Vec3d(a,s,i)}angleBetween(t){let e=Vec3d.createFrom(t);return this.dot(e)/(this.length*e.length)}getDist(t){let e=Vec3d.createFrom(t).sub(this);return Math.hypot(e.x,e.y,e.z)}inverse(){return new Vec3d(1/this.x,1/this.y,1/this.z)}normalise(){return 0!==this.length?this.scale(1/this.length):new Vec3d}applyFunc(t){return new Vec3d(t(this.x),t(this.y),t(this.z))}useNMC(t){let e=Vec3d.createFrom(t);return this.x+=1,this.y+=1,this.x*=e.x,this.y*=e.y,new Vec3d(this.x,this.y,this.z,this.w)}clone(){return new Vec3d(this.x,this.y,this.z)}toArray(){return[this.x,this.y,this.z,this.w]}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}draw(t,e,a,s){let i=Vec3d.createFrom(e);t.save(),t.lineWidth=s,t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(this.x,this.y),t.strokeStyle=a,t.stroke(),t.beginPath(),t.translate(this.x,this.y),t.scale(1,1),t.arc(0,0,3,0,2*Math.PI),t.closePath(),t.fillStyle=a,t.fill(),t.restore()}}class Mat3x3{static validate(t){if(!(t instanceof Array))throw new Error("Matrix must be an instance of Array");if(3!==t.length)throw new Error("Insufficient 3x3 matrice data");for(let e=t.length-1;e>0;e--)if(t[e].length<3)throw new Error("Insufficient 3x3 matrice data")}static getData(t){if(t instanceof Mat3x3)return t.data;if(t instanceof Array)return Mat3x3.validate(t),t;throw new Error("getData expects an argument of an Array instance")}static multiplyVec(t,e){let a=[],s=0,i=Mat3x3.getData(e),n=t;t instanceof Array&&3===t.length?n=t:t instanceof Object&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&(n=[t.x,t.y,1]);for(let t=0;t<i.length;t++){s=0;for(let e=0;e<i.length;e++){s+=n[e]*i[e][t]}a.push(s)}return a}static rotate(t){return new Mat3x3([[Math.cos(t),Math.sin(t),0],[-Math.sin(t),Math.cos(t),0],[0,0,1]])}static createEmpty(){return new Mat3x3([[0,0,0],[0,0,0],[0,0,0]])}constructor(t){Mat3x3.validate(t),this.data=t}add(t){let e=[],a=Mat3x3.getData(t);for(let t=0;t<this.data.length;t++){e.push(new Array(3));for(let s=0;s<this.data.length;s++)e[t][s]=this.data[t][s]+a[t][s]}return new Mat3x3(e)}sub(t){let e=[],a=Mat3x3.getData(t);for(let t=0;t<this.data.length;t++){e.push(new Array(3));for(let s=0;s<this.data.length;s++)e[t][s]=this.data[t][s]-a[t][s]}return new Mat3x3(e)}determinant(){return this.data[0][0]*(this.data[1][1]*this.data[2][2]-this.data[1][2]*this.data[2][1])-this.data[0][1]*(this.data[1][0]*this.data[2][2]-this.data[1][2]*this.data[2][0])+this.data[0][2]*(this.data[1][0]*this.data[2][1]-this.data[1][1]*this.data[2][0])-d}scale(t){let e=[];Mat3x3.getData(arg);for(let a=0;a<this.data.length;a++)for(let s=0;s<this.data.length;s++)e[a][s]=this.data[a][s]*t;return new Mat3x3(e)}transpose(){return new Mat3x3([[this.data[0][0],this.data[1][0],this.data[2][0]],[this.data[0][1],this.data[1][1],this.data[2][1]],[this.data[0][2],this.data[1][2],this.data[2][2]]])}}class Mat4x4{static validate(t){if(!(t instanceof Array))throw new Error("Matrix must be an instance of Array");if(4!==t.length)throw new Error("Insufficient 4x4 matrice data");for(let e=t.length-1;e>0;e--)if(t[e].length<4)throw new Error("Insufficient 4x4 matrice data")}static getData(t){if(t instanceof Mat4x4)return t.data;if(t instanceof Array)return Mat4x4.validate(t),t;throw new Error("getData expects an argument of an Array instance")}static multiplyVec(t,e){let a=[],s=0,i=Mat4x4.getData(e),n=t;t instanceof Array&&4===t.length?n=t:t instanceof Object&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z")&&(n=[t.x,t.y,t.z,1]);for(let t=0;t<i.length;t++){s=0;for(let e=0;e<i.length;e++){s+=n[e]*i[e][t]}a.push(s)}if(0!==a[3])for(let t=0;t<a.length-1;t++)a[t]/=a[3];return a}static createEmpty(){return new Mat4x4([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]])}static rotateX(t){return new Mat4x4([[1,0,0,0],[0,Math.cos(t),Math.sin(t),0],[0,-Math.sin(t),Math.cos(t),0],[0,0,0,1]])}static rotateY(t){return new Mat4x4([[Math.cos(t),0,Math.sin(t),0],[0,1,0,0],[-Math.sin(t),0,Math.cos(t),0],[0,0,0,1]])}static rotateZ(t){return new Mat4x4([[Math.cos(t),Math.sin(t),0,0],[-Math.sin(t),Math.cos(t),0,0],[0,0,1,0],[0,0,0,1]])}static project3d(t,e,a=.1,s=1e3){let i=s/(s-a);return new Mat4x4([[t*e,0,0,0],[0,e,0,0],[0,0,i,1],[0,0,-a*i,0]])}constructor(t){Mat4x4.validate(t),this.data=t}add(t){let e=[],a=Mat4x4.getData(t);for(let t=0;t<this.data.length;t++){e.push(new Array(4));for(let s=0;s<this.data.length;s++)e[t][s]=this.data[t][s]+a[t][s]}return new Mat4x4(e)}sub(t){let e=[],a=Mat4x4.getData(t);for(let t=0;t<this.data.length;t++){e.push(new Array(4));for(let s=0;s<this.data.length;s++)e[t][s]=this.data[t][s]-a[t][s]}return new Mat4x4(e)}scale(t){let e=[];Mat4x4.getData(arg);for(let a=0;a<this.data.length;a++)for(let s=0;s<this.data.length;s++)e[a][s]=this.data[a][s]*t;return new Mat4x4(e)}determinant(){return this.data[0][0]*(this.data[1][1]*(this.data[2][2]*this.data[3][3]-this.data[2][3]*this.data[3][2]))-this.data[0][1]*(this.data[1][0]*(this.data[2][2]*this.data[3][3]-this.data[2][3]*this.data[3][2]))+this.data[0][2]*(this.data[1][0]*(this.data[2][1]*this.data[3][3]-this.data[2][3]*this.data[3][1]))-this.data[0][3]*(this.data[1][0]*(this.data[2][1]*this.data[3][2]-this.data[2][2]*this.data[3][1]))}transpose(){return new Mat4x4([[this.data[0][0],this.data[1][0],this.data[2][0],this.data[3][0]],[this.data[0][1],this.data[1][1],this.data[2][1],this.data[3][0]],[this.data[0][2],this.data[1][2],this.data[2][2],this.data[3][0]]])}}Object.defineProperties(HTMLElement.prototype,{css:{value:function(t){if(!t instanceof Object)throw new Error("CSS Styling data must be an instanceof an Object");for(const e in t)this.style[e]=t[e]}},setCss:{value:function(t,e){this.styles[t]=e}},attr:{value:function(t){if(!t instanceof Object)throw new Error("ATTR data must be an instanceof an Object");for(const e in t)this[e]=t[e]}}});class GameArea{constructor(t,e,a){this.w=t||300,this.h=e||300,this.config=a,this.state=!1,this.section=document.createElement("section"),this.section.style.margin="0",this.state=!1,this._preloadScene=new PreloadScene(this.section,this.w,this.h,this.config),this._mirielleScene=new MirielleScene(this.section,this.w,this.h,a.mirielle),this.section.class="gameScene",this.onReady=null,this._allScenes=[],this.files=[],this._preloadScene.start(),document.body.appendChild(this.section)}getArea(){return this.section}getMedia(t,e="img"){let a=this._preloadScene;if("img"===e||"image"===e){return a._preloadedImages.filter(e=>e.name===t)[0].img}if("aud"===e||"audio"===e){return a._preloadedAudios.filter(e=>e.name===t)[0].aud}if("other"===e||"json"===e){return this._preloadScene._preloadedFiles.filter(e=>e.name===t)[0].res}}animate(){const t=e=>{"function"==typeof this.clear&&"function"==typeof this.update&&(this.clear(),this.update(),requestAnimationFrame(t))};return t}init(){const t=()=>{this._allScenes.forEach(t=>{t instanceof Scene?(this.section.appendChild(t.getCanvas()),t._fpsStarted=performance.now(),t._elapsedTimeStarted=(new Date).getTime(),t.dynamic?requestAnimationFrame(t.animate()):"function"==typeof this.update?t.update():console.error("Scene does not have a valid update method")):this.section.appendChild(t)})};let e=setInterval(()=>{this._mirielleScene.state&&(0!==this.config.preload.length?this._preloadScene.state?(clearInterval(e),this.state=!0,this.files.push(this._preloadScene._preloadedFiles),"function"==typeof this.onReady&&this.onReady(),t()):this._preloadScene.activeScene():(clearInterval(e),this.state=!0,t()))},0)}appendChild(...t){t.forEach(t=>{t instanceof HTMLElement&&this._allScenes.push(t)})}getWidth(){return this.w}getHeight(){return this.h}}class MirielleScene{constructor(t,e,a,s){this._parent=t,this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=a,this._canvas.style.position="absolute",this.state=!1,this._parent.appendChild(this._canvas),this.config=s,this.ctx=this._canvas.getContext("2d");let i=5,n=Math.max(35,s.fontSize)||35,h=Math.max(35,s.fontFamily)||"Verdana";"dark"===this.config.theme?this._canvas.style.backgroundColor="#222":"light"===this.config.theme?this._canvas.style.backgroundColor="#fff":this.config.theme="light",this.ctx.beginPath(),this.ctx.moveTo(e/2,a/2-20);for(let t=0;t<=360;t+=60){let s=t*Math.PI/180,i=3*n,h=e/2+Math.cos(s)*i,r=a/2-20+Math.sin(s)*i;this.ctx.lineTo(h,r)}this.ctx.fillStyle="light"===this.config.theme?"dimgray":"#333",this.ctx.fill(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font=`bold ${n}px ${h}`,this.ctx.fillStyle="light"===this.config.theme?"#fff":"dimgray",this.ctx.fillText("Bat Games",e/2,a/2-20),this.ctx.font=`bold ${n-(n-10)}px ${h}`,this.ctx.fillStyle="red",this.ctx.fillText("Games API for web developers on a GO",e/2,a/2+20),this.ctx.font=`bold 10px ${h}`,this.ctx.fillStyle="light"===this.config.theme?"#222":"#fff",this.ctx.fillText("Mirielle "+(new Date).getFullYear(),e/2,a-50);let r=setTimeout(()=>{clearTimeout(r),this._parent.removeChild(this._canvas),this.state=!0},1e3*i)}}class PreloadScene{constructor(t,e,a,s){if(this.parent=t,this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=a,this._canvas.style.position="absolute",this.state=!1,this.parent.appendChild(this._canvas),this.config=s,this.ctx=this._canvas.getContext("2d"),this.preload=this.config.preload||[],this._preloadedAssetsCounter=0,this._preloadedImages=[],this._preloadedAudios=[],this._preloadedFiles=[],this._preloadAngle=0,this._preloadScale=5,this._preloadColorIndex=0,0!==this.preload.length){let t=[".jpg",".gif",".png"],e=[".mp3"],a=[".txt"];if(!(this.preload instanceof Array))throw TypeError("Failed to initialize preload: Must be an instanceof of an Array");this.preload.forEach((s,i)=>{if(t.some(t=>s.src.endsWith(t))||void 0!==s.type&&"img"===s.type||"image"===s.type)this._preloadedImages.push({img:new Image,ind:i,...s});else if(e.some(t=>s.src.endsWith(t))||void 0!==s.type&&"aud"===s.type||"audio"===s.type)this._preloadedAudios.push({aud:new Audio,ind:i,...s});else{if(!(a.some(t=>s.src.endsWith(t))||void 0!==s.type&&"other"===s.type||"file"===s.type))throw TypeError(`Invalid Media extension for ${s.src}`);this._preloadedFiles.push({type:"file",...s})}})}}start(){const t=()=>{this._preloadedAssetsCounter===this.config.preload.length&&(this.state=!0,this.parent.removeChild(this._canvas))};this._preloadedImages.forEach(e=>{e.img.addEventListener("load",()=>{this._preloadedAssetsCounter++,t()}),e.img.src=e.src}),this._preloadedAudios.forEach(e=>{e.aud.addEventListener("canplaythrough",()=>{this._preloadedAssetsCounter++,t()}),e.aud.src=e.src});this._preloadedFiles.forEach(e=>{((e,a)=>{let s=new XMLHttpRequest;s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?(a._preloadedAssetsCounter++,e.res=s.responseText,t()):console.error("Bad Internet Connection: Failed to get "+url))},s.open("GET",e.src),s.send()})(e,this)})}activeScene(){let t=this._canvas.width,e=this._canvas.height;"dark"===this.config.mirielle.theme?this.ctx.fillStyle="#222":this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,t,e);let a=["red","teal","yellow","navy"];this._preloadAngle++;let s=Math.sin(Math.degToRad(this._preloadAngle))*this._preloadScale,i=Math.sin(Math.degToRad(this._preloadAngle))*this._preloadScale;this.ctx.save(),this.ctx.translate(t/2-22.5,e/2-22.5),this.ctx.rotate(Math.degToRad(this._preloadAngle+10)),this.ctx.scale(s,i);for(let t=0;t<2;t++)for(let e=0;e<2;e++){let s=22.5*e-22.5,i=22.5*t-22.5;this.ctx.fillStyle=t<1?a[t+e]:a[Math.min(3,2+e)],this.ctx.fillRect(s,i,17.5,17.5)}this.ctx.restore()}}class Scene{constructor(t,e=!1){this._parent=t,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this.ctx=this._canvas.getContext("2d"),this.dynamic=e,this._canvas.width=this._parent.w||300,this._canvas.height=this._parent.h||300,this._canvas.class="canvasScene",this.clear=(()=>this.ctx.clearRect(0,0,this._canvas.width,this._canvas.height)),this.update=null,this._fpsStarted=performance.now(),this._elapsedTimeStarted=(new Date).getTime(),this._parent.getArea().appendChild(this._canvas),this._parent._allScenes.push(this)}animate(){const t=e=>{"function"==typeof this.clear&&"function"==typeof this.update&&(this.clear(),this.update(),requestAnimationFrame(t))};return t}getFPS(){let t=performance.now(),e=1e3/(t-this._fpsStarted);return this._fpsStarted=t,e}getElapsedTime(){let t=(new Date).getTime(),e=.001*(t-this._elapsedTimeStarted);return this._elapsedTimeStarted=t,e>.2&&(e=0),e}getContext(){return this._canvas.getContext("2d")}getWidth(){return this._canvas.width}getHeight(){return this._canvas.height}getCanvas(){return this._canvas}getParent(){return this._parent}}window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};const Bat={Core:{init(t){addEventListener("load",()=>{if("function"!=typeof t)throw TypeError("Failed To Initialize Bat: callback must be a function");t()})}},Utils:{randFromArray:t=>t[~~(Math.random()*t.length)],objectToCSSFormat(t){for(let e of t)if(e.charCodeAt()>=65&&e.charCodeAt()<=90){let a=e;t=t.replaceAll(e,`-${a.toLowerCase()}`)}return t}}};class OrthographicMap{static getMapId(t,e,a=0){let s=Vec2d.createFrom(e);return void 0!==t[0][0]?t[s.y][s.x]:t[s.y*a+s.x]}static getTileSetIndex(t,e){let a=Vec2d.createFrom(t);return new Vec2d(a.x%e,a.y/e)}constructor(t,e,a){if(!(t instanceof Array))throw TypeError("Failed to Initialize Map: expects an instance of an Array");this.map=t,this.size=Vec2d.createFrom(e),null!=this.map[0][0]?(this.type="2D",this.dimension=Vec2d.createFrom({x:this.map[0].length,y:this.map.length})):(this.type="1D",this.dimension=Vec2d.createFrom(a)),this.index=new Vec2d,this.id=null,this.minView=new Vec2d,this.maxView=this.dimension}setView(t,e){this.minView=Vec2d.createFrom(t),this.maxView=Vec2d.createFrom(e)}render(t){for(let e=this.minView.y;e<this.maxView.y;e++)for(let a=this.minView.x;a<this.maxView.x;a++)this.index=new Vec2d(a,e),this.id=OrthographicMap.getMapId(this.map,this.index,this.dimension.x),t()}}class OrthographicCamera{constructor(t=new Vec3d,e=new Vec3d){this.pos=Vec3d.createFrom(t),this.dimension=Vec3d.createFrom(e),this.minPos=new Vec3d,this.maxPos=new Vec3d,this._shakeEnabled=!1,this._isShaking=!1,this._shakeTimeOut=0}lookAt(t,e){let a=Vec3d.createFrom(e);a.z=this.pos.z,this.minPos=this.pos.mult(a.inverse()).applyFunc(Math.floor),this.maxPos=this.pos.add(this.dimension).mult(a.inverse()).applyFunc(Math.ceil)}setMapClamp(t,e){let a=Vec3d.createFrom(t),s=Vec3d.createFrom(e);this.minPos.x<a.x?this.minPos.x=a.x:this.maxPos.x>s.x&&(this.maxPos.x=s.x),this.minPos.y<a.y?this.minPos.y=a.y:this.maxPos.y>s.y&&(this.maxPos.y=s.y)}setPosClamp(t,e){let a=Vec3d.createFrom(t),s=Vec3d.createFrom(e);this.pos.x<a.x?this.pos.x=a.x:this.pos.x+this.dimension.x>s.x&&(this.pos.x=s.x-this.dimension.x),this.pos.y<a.y?this.pos.y=a.y:this.pos.y+this.dimension.y>s.y&&(this.pos.y=s.y-this.dimension.y),this.pos.z<a.z?this.pos.z=a.z:this.pos.z>s.z&&(this.pos.z=s.z)}follow(t,e){if(this._isShaking){let a=Vec3d.createFrom(t),s=Vec3d.createFrom(e);this.pos=a.add(s.scale(.5)).sub(this.dimension.scale(.5)).scale(1*Math.sin(20*Math.random()))}else{let a=Vec3d.createFrom(t),s=Vec3d.createFrom(e);this.pos=a.add(s.scale(.5)).sub(this.dimension.scale(.5))}}shakeEnabled(t,e=new Vec2d){this._shakeEnabled=!0,this._shakeOrigin=Vec2d.createFrom(t),this._shakeDimension=Vec2d.createFrom(e),this._shakePivot=this._shakeOrigin.add(this._shakeDimension.scale(.5))}shake(t,e){if(!this._shakeEnabled)throw new Error("Cannot shake Camera: Please enabled camera shake by calling it's method");{let t=this._shakePivot.x+1*Math.sin(20*Math.random()),e=this._shakePivot.y+1*Math.sin(20*Math.random());this.pos=Vec2d.createFrom([t,e])}}}