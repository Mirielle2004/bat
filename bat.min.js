/**
 * 
 * @author Mirielle S.
 * name: Bat.min.js
 * Last Revision: 11th Nov. 2020
 * 
 * 
 * MIT License 
 * Copyright (c) 2020 CodeBreaker
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
Object.defineProperties(Math,{degToRad:{value:function(t){return t*this.PI/180}},radToDeg:{value:function(t){return 180*t/this.PI}},isEven:{value:function(t){return!(1&t)}},randRange:{value:function(t,e){return this.random()*(e-t+1)+t}},clamp:{value:function(t,e,s){return this.min(this.max(t,+s),e)}}});class Vec2d{static createFrom(t){if(t instanceof Vec2d)return t;if(t instanceof Array)return new Vec2d(t[0],t[1]);if(t instanceof Object)return new Vec2d(t.x,t.y);throw new Error("Insufficient vector's data")}static getDist(t,e){let s=Vec2d.createFrom(e).sub(Vec2d.createFrom(t));return Math.hypot(s.x,s.y)}constructor(t=0,e=0,s=1){this.x=t,this.y=e,this.w=s,this.o={x:0,y:0,w:1},this.angle=Math.atan2(this.y,this.x),this.length=Math.hypot(this.x,this.y)}add(t){let e=Vec2d.createFrom(t);return new Vec2d(this.x+e.x,this.y+e.y)}sub(t){let e=Vec2d.createFrom(t);return new Vec2d(this.x-e.x,this.y-e.y)}scale(t){return new Vec2d(this.x*t,this.y*t)}addScale(t,e){let s=Vec2d.createFrom(t);return new Vec2d(this.x+s.x*e,this.y+s.y*e)}mult(t){let e=Vec2d.createFrom(t);return new Vec2d(this.x*e.x,this.y*e.y)}dot(t){let e=Vec2d.createFrom(t);return this.x*e.x+this.y*e.y}angleBetween(t){let e=Vec2d.createFrom(t);return this.dot(e)/(this.length*e.length)}getDist(t){let e=Vec2d.createFrom(t).sub(this);return Math.hypot(e.x,e.y)}inverse(){return new Vec2d(1/this.x,1/this.y)}normalise(){return 0!==this.length?this.scale(1/this.length):new Vec2d}getOrthogonal(){let t=90*Math.PI/180+this.angle,e=Math.cos(t),s=Math.sin(t);return new Vec2d(e,s)}applyFunc(t){return new Vec2d(t(this.x),t(this.y))}useNMC(t){let e=Vec3d.createFrom(t);return this.x+=1,this.y+=1,this.x*=e.x,this.y*=e.y,new Vec2d(this.x,this.y,1)}clone(){return new Vec2d(this.x,this.y)}toArray(){return[this.x,this.y]}toObject(){return{x:this.x,y:this.y}}draw(t,e,s=0){t.save(),t.lineWidth=s,t.beginPath(),t.moveTo(this.o.x,this.o.y),t.lineTo(this.o.x+this.x,this.o.y+this.y),t.strokeStyle=e,t.stroke(),t.beginPath(),t.arc(this.o.x+this.x,this.o.y+this.y,3+s,0,2*Math.PI),t.closePath(),t.fillStyle=e,t.fill(),t.restore()}}class Vec3d{static createFrom(t){if(t instanceof Vec3d)return t;if(t instanceof Array)return new Vec3d(t[0],t[1],t[2],1);if(t instanceof Object)return new Vec3d(t.x,t.y,t.z,1);throw new Error("Insufficient vector's data")}static getDist(t,e){let s=Vec3d.createFrom(e).sub(Vec3d.createFrom(t));return Math.hypot(s.x,s.y)}constructor(t=0,e=0,s=0,i=1){this.x=t,this.y=e,this.z=s,this.w=i,this.o={x:0,y:0,z:0,w:1},this.length=Math.hypot(this.x,this.y,this.z)}add(t){let e=Vec3d.createFrom(t);return new Vec3d(this.x+e.x,this.y+e.y,this.z+e.z)}sub(t){let e=Vec3d.createFrom(t);return new Vec3d(this.x-e.x,this.y-e.y,this.z-e.z)}scale(t){return new Vec2d(this.x*t,this.y*t,this.z*t)}addScale(t,e){let s=Vec3d.createFrom(t);return new Vec3d(this.x+s.x*e,this.y+s.y*e,this.z+s.z*e)}mult(t){let e=Vec3d.createFrom(t);return new Vec3d(this.x*e.x,this.y*e.y,this.z*e.z)}dot(t){let e=Vec3d.createFrom(t);return this.x*e.x+this.y*e.y+this.z*e.z}cross(t){let e=Vec3d.createFrom(t),s=this.y*e.z-this.z*e.y,i=this.z*e.x-this.x*e.z,a=this.x*e.y-this.y*e.x;return new Vec3d(s,i,a)}angleBetween(t){let e=Vec3d.createFrom(t);return this.dot(e)/(this.length*e.length)}getDist(t){let e=Vec3d.createFrom(t).sub(this);return Math.hypot(e.x,e.y,e.z)}inverse(){return new Vec3d(1/this.x,1/this.y,1/this.z)}normalise(){return 0!==this.length?this.scale(1/this.length):new Vec3d}applyFunc(t){return new Vec3d(t(this.x),t(this.y),t(this.z))}useNMC(t){let e=Vec3d.createFrom(t);return this.x+=1,this.y+=1,this.x*=e.x,this.y*=e.y,new Vec3d(this.x,this.y,this.z,this.w)}clone(){return new Vec3d(this.x,this.y,this.z)}toArray(){return[this.x,this.y,this.z,this.w]}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}draw(t,e,s,i){let a=Vec3d.createFrom(e);t.save(),t.lineWidth=i,t.beginPath(),t.moveTo(a.x,a.y),t.lineTo(this.x,this.y),t.strokeStyle=s,t.stroke(),t.beginPath(),t.translate(this.x,this.y),t.scale(1,1),t.arc(0,0,3,0,2*Math.PI),t.closePath(),t.fillStyle=s,t.fill(),t.restore()}}class Mat3x3{static validate(t){if(!(t instanceof Array))throw new Error("Matrix must be an instance of Array");if(3!==t.length)throw new Error("Insufficient 3x3 matrice data");for(let e=t.length-1;e>0;e--)if(t[e].length<3)throw new Error("Insufficient 3x3 matrice data")}static getData(t){if(t instanceof Mat3x3)return t.data;if(t instanceof Array)return Mat3x3.validate(t),t;throw new Error("getData expects an argument of an Array instance")}static multiplyVec(t,e){let s=[],i=0,a=Mat3x3.getData(e),n=t;t instanceof Array&&3===t.length?n=t:t instanceof Object&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&(n=[t.x,t.y,1]);for(let t=0;t<a.length;t++){i=0;for(let e=0;e<a.length;e++){i+=n[e]*a[e][t]}s.push(i)}return s}static rotate(t){return new Mat3x3([[Math.cos(t),Math.sin(t),0],[-Math.sin(t),Math.cos(t),0],[0,0,1]])}static createEmpty(){return new Mat3x3([[0,0,0],[0,0,0],[0,0,0]])}constructor(t){Mat3x3.validate(t),this.data=t}add(t){let e=[],s=Mat3x3.getData(t);for(let t=0;t<this.data.length;t++){e.push(new Array(3));for(let i=0;i<this.data.length;i++)e[t][i]=this.data[t][i]+s[t][i]}return new Mat3x3(e)}sub(t){let e=[],s=Mat3x3.getData(t);for(let t=0;t<this.data.length;t++){e.push(new Array(3));for(let i=0;i<this.data.length;i++)e[t][i]=this.data[t][i]-s[t][i]}return new Mat3x3(e)}determinant(){return this.data[0][0]*(this.data[1][1]*this.data[2][2]-this.data[1][2]*this.data[2][1])-this.data[0][1]*(this.data[1][0]*this.data[2][2]-this.data[1][2]*this.data[2][0])+this.data[0][2]*(this.data[1][0]*this.data[2][1]-this.data[1][1]*this.data[2][0])-d}scale(t){let e=[];Mat3x3.getData(arg);for(let s=0;s<this.data.length;s++)for(let i=0;i<this.data.length;i++)e[s][i]=this.data[s][i]*t;return new Mat3x3(e)}transpose(){return new Mat3x3([[this.data[0][0],this.data[1][0],this.data[2][0]],[this.data[0][1],this.data[1][1],this.data[2][1]],[this.data[0][2],this.data[1][2],this.data[2][2]]])}}class Mat4x4{static validate(t){if(!(t instanceof Array))throw new Error("Matrix must be an instance of Array");if(4!==t.length)throw new Error("Insufficient 4x4 matrice data");for(let e=t.length-1;e>0;e--)if(t[e].length<4)throw new Error("Insufficient 4x4 matrice data")}static getData(t){if(t instanceof Mat4x4)return t.data;if(t instanceof Array)return Mat4x4.validate(t),t;throw new Error("getData expects an argument of an Array instance")}static multiplyVec(t,e){let s=[],i=0,a=Mat4x4.getData(e),n=t;t instanceof Array&&4===t.length?n=t:t instanceof Object&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z")&&(n=[t.x,t.y,t.z,1]);for(let t=0;t<a.length;t++){i=0;for(let e=0;e<a.length;e++){i+=n[e]*a[e][t]}s.push(i)}if(0!==s[3])for(let t=0;t<s.length-1;t++)s[t]/=s[3];return s}static createEmpty(){return new Mat4x4([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]])}static rotateX(t){return new Mat4x4([[1,0,0,0],[0,Math.cos(t),Math.sin(t),0],[0,-Math.sin(t),Math.cos(t),0],[0,0,0,1]])}static rotateY(t){return new Mat4x4([[Math.cos(t),0,Math.sin(t),0],[0,1,0,0],[-Math.sin(t),0,Math.cos(t),0],[0,0,0,1]])}static rotateZ(t){return new Mat4x4([[Math.cos(t),Math.sin(t),0,0],[-Math.sin(t),Math.cos(t),0,0],[0,0,1,0],[0,0,0,1]])}static project3d(t,e,s=.1,i=1e3){let a=i/(i-s);return new Mat4x4([[t*e,0,0,0],[0,e,0,0],[0,0,a,1],[0,0,-s*a,0]])}constructor(t){Mat4x4.validate(t),this.data=t}add(t){let e=[],s=Mat4x4.getData(t);for(let t=0;t<this.data.length;t++){e.push(new Array(4));for(let i=0;i<this.data.length;i++)e[t][i]=this.data[t][i]+s[t][i]}return new Mat4x4(e)}sub(t){let e=[],s=Mat4x4.getData(t);for(let t=0;t<this.data.length;t++){e.push(new Array(4));for(let i=0;i<this.data.length;i++)e[t][i]=this.data[t][i]-s[t][i]}return new Mat4x4(e)}scale(t){let e=[];Mat4x4.getData(arg);for(let s=0;s<this.data.length;s++)for(let i=0;i<this.data.length;i++)e[s][i]=this.data[s][i]*t;return new Mat4x4(e)}determinant(){return this.data[0][0]*(this.data[1][1]*(this.data[2][2]*this.data[3][3]-this.data[2][3]*this.data[3][2]))-this.data[0][1]*(this.data[1][0]*(this.data[2][2]*this.data[3][3]-this.data[2][3]*this.data[3][2]))+this.data[0][2]*(this.data[1][0]*(this.data[2][1]*this.data[3][3]-this.data[2][3]*this.data[3][1]))-this.data[0][3]*(this.data[1][0]*(this.data[2][1]*this.data[3][2]-this.data[2][2]*this.data[3][1]))}transpose(){return new Mat4x4([[this.data[0][0],this.data[1][0],this.data[2][0],this.data[3][0]],[this.data[0][1],this.data[1][1],this.data[2][1],this.data[3][0]],[this.data[0][2],this.data[1][2],this.data[2][2],this.data[3][0]]])}}class BasicComponent{constructor(t,e,s){if(this.validTypes=["rect","circle","line","polygon"],!this.validTypes.some(e=>e===t))throw TypeError(`Failed to create Component, valid type \n\t\t\t\tmust be from ${this.validTypes}`);this.type=t,"rect"===this.type?(this.pos=Vec2d.createFrom(e),this.dimension=Vec2d.createFrom(s)):"circle"===this.type?(this.pos=Vec2d.createFrom(e),this.r=s):"line"===this.type?(this.start=Vec2d.createFrom(e),this.end=Vec2d.createFrom(s)):"polygon"===this.type&&(this.pos=Vec2d.createFrom(e),this.vertices=[],s instanceof Array&&void 0!==s[0][0]&&s.forEach(t=>{this.vertices.push(Vec2d.createFrom(t))}))}}class TileComponent{constructor(t,e){this.pos=Vec2d.createFrom(t),this.dimension=Vec2d.createFrom(e),this.velocity=new Vec2d,this.lastPos=null,this.nextPos=null,this.currentPos=null,this._minpos=null,this._maxpos=null}orthBoundaryCollision(t,e,{left:s=null,top:i=null}){if(!(t instanceof OrthographicMap))throw new Error("Map object must be an instanceof OrthographicMap");this.lastPos=this.pos,this.nextPos=Vec2d.createFrom({x:this.lastPos.x+e.x,y:this.lastPos.y}),this._minpos=this.nextPos.mult(t.size.inverse()).applyFunc(Math.floor),this._maxpos=this.nextPos.add(this.dimension).mult(t.size.inverse()).applyFunc(Math.ceil);for(let e=this._minpos.y;e<this._maxpos.y;e++)for(let i=this._minpos.x;i<this._maxpos.x;i++)this.currentPos=OrthographicMap.getMapId(t,[i,e]),"function"==typeof s&&s();this.pos=this.nextPos,this.lastPos=this.pos,this.nextPos=Vec2d.createFrom({x:this.lastPos.x,y:this.lastPos.y+e.y}),this._minpos=this.nextPos.mult(t.size.inverse()).applyFunc(Math.floor),this._maxpos=this.nextPos.add(this.dimension).mult(t.size.inverse()).applyFunc(Math.ceil);for(let e=this._minpos.y;e<this._maxpos.y;e++)for(let s=this._minpos.x;s<this._maxpos.x;s++)this.currentPos=OrthographicMap.getMapId(t,[s,e]),"function"==typeof i&&i();this.pos=this.nextPos}}const Component={Basic:function(t,e,s){return new BasicComponent(t,e,s)},Tile:function(t,e){return new TileComponent(t,e)}};class Collision2DDetect{static circle(t,e){return Vec2d.createFrom(e.pos).sub(Vec2d.createFrom(t.pos)).length<=t.r+e.r}static rect(t,e){let s=Component.Basic("rect",t.pos,t.dimension),i=Component.Basic("rect",e.pos,e.dimension);return s.pos.x+s.dimension.x>i.pos.x&&i.pos.x+i.dimension.x>s.pos.x&&s.pos.y+s.dimension.y>i.pos.y&&i.pos.y+s.dimension.y>s.pos.y}static circleRect(t,e){let s=Component.Basic("circle",t.pos,t.r),i=Component.Basic("rect",e.pos,e.dimension),a=Math.abs(s.pos.x-(i.pos.x+.5*i.dimension.x)),n=Math.abs(s.pos.y-(i.pos.y+.5*i.dimension.y));if(a>s.r+.5*i.dimension.x)return!1;if(n>s.r+.5*i.dimension.y)return!1;if(a<=i.dimension.x)return!0;if(n<=i.dimension.y)return!0;let r=a-i.dimension.x,h=n-i.dimension.y;return Math.hypot(r,h)<=s.r*s.r}static lineIntercept(t,e){return function(t,e){let s,i,a,n=t.end.sub(t.start),r=e.end.sub(e.start),h={x:null,y:null};return 0!=(s=n.x*r.y-n.y*r.x)&&(h=t.start.sub(e.start),(a=(n.x*h.y-n.y*h.x)/s)>=0&&a<=1&&(i=(r.x*h.y-r.y*h.x)/s)>=0&&i<=1)}(Component.Basic("line",t.start,t.end),Component.Basic("line",e.start,e.end))}static pointAtLineIntercept(t,e){return function(t,e){let s,i,a,n=t.end.sub(t.start),r=e.end.sub(e.start),h={x:null,y:null};return 0!=(s=n.x*r.y-n.y*r.x)&&(h=t.start.sub(e.start),(a=(n.x*h.y-n.y*h.x)/s)>=0&&a<=1&&(i=(r.x*h.y-r.y*h.x)/s)>=0&&i<=1&&t.start.addScale(n,i))}(Component.Basic("line",t.start,t.end),Component.Basic("line",e.start,e.end))}static lineInterceptCircle(t,e){let s=Component.Basic("line",t.start,t.end),i=Component.Basic("circle",e.pos,e.r),a=i.pos.sub(s.start),n=s.end.sub(s.start),r=a.dot(n)/(n.x*n.x+n.y*n.y),h=s.start.addScale(n,r);return r<0&&(h.x=s.start.x,h.y=s.start.y),r>1&&(h.x=s.end.x,h.y=s.end.y),(i.pos.x-h.x)*(i.pos.x-h.x)+(i.pos.y-h.y)*(i.pos.y-h.y)<i.r*i.r}static lineInterceptRect(t,e){let s=Component.Basic("line",t.start,t.end),i=Component.Basic("rect",e.pos,e.dimension);function a(t,e,s,i){var a=(i.x-s.x)*(t.y-s.y)-(i.y-s.y)*(t.x-s.x),n=(e.x-t.x)*(t.y-s.y)-(e.y-t.y)*(t.x-s.x),r=(i.y-s.y)*(e.x-t.x)-(i.x-s.x)*(e.y-t.y);return 0==a&&0==n&&0==r?null:0==r?null:(n/=r,(a/=r)>=0&&a<=1&&n>=0&&n<=1)}let n={x:s.start.x,y:s.start.y},r={x:s.end.x,y:s.end.y},h=i.pos,o={x:i.pos.x+i.dimension.x,y:i.pos.y};return!!a(n,r,h,o)||(!!a(n,r,h=o,o={x:i.pos.x+i.dimension.x,y:i.pos.y+i.dimension.y})||(!!a(n,r,h=o,o={x:i.pos.x,y:i.pos.y+i.dimension.y})||!!a(n,r,h=o,o={x:i.pos.x,y:i.pos.y})))}static isPointInArc(t,e){if(void 0===e.pos||void 0===e.innerRadius||void 0===e.outerRadius||void 0===e.startAngle||void 0===e.endAngle)throw new Error('Insufficient Arc data: Must provide a "pos, innerRadius, outerRadius, startAngle, endAngle"');let s=t.sub(Vec2d.createFrom(e.pos)),i=e.outerRadius,a=e.innerRadius;if(s.length<a||s.length>i)return!1;let n=(s.angle+2*Math.PI)%Math.PI*2;return n>=e.startAngle&&n<=e.endAngle}static isPointInWedge(t,e){if(void 0===e.pos||void 0===e.r||void 0===e.startAngle)throw new Error('Insufficient Wedge\'s data: Must provide a "pos, r, startAngle"');let s=2*Math.PI,i=t.sub(e.pos),a=e.r*e.r;if(i.length>a)return!1;let n=(i.angle+s)%s;return n>=e.startAngle&&n<=e.endAngle}static isPointInCircle(t,e){return t.sub(e.pos).length<e.r*e.r}static isPointInRect(t,e){return t.x>e.pos.x&&t.x<e.pos.x+e.dimension.x&&t.y>e.pos.y&&t.y<e.pos.y+e.dimension.y}}const Physics={Collision2D:{Detect:Collision2DDetect}};class OrthographicMap{static getMapId(t,e){let s=Vec2d.createFrom(e);if("2D"===t.type){if("number"===t.dataType)return t.map[s.y][s.x];if("string"===t.dataType)return t.map[s.y][0][s.x]}else if("1D"===t.type){if("number"===t.dataType)return t.map[s.y*t.dimension.x+s.x];if("string"===t.dataType)return t.map[0][s.y*t.dimension.x+s.x]}}static getTileSetIndex(t,e){let s=Vec2d.createFrom(t);return new Vec2d(s.x%e,s.y/e)}constructor(t,e,s){if(!(t instanceof Array))throw TypeError("Failed to Initialize Map: expects an instance of an Array");this.map=t,this.size=Vec2d.createFrom(e),this.dataType=null,null!=this.map[0][0]?(this.type="2D","string"==typeof this.map[0][0]?(this.dataType="string",this.dimension=Vec2d.createFrom({x:this.map[0][0].length,y:this.map.length})):(this.dataType="number",this.dimension=Vec2d.createFrom({x:this.map[0].length,y:this.map.length}))):(this.type="1D",this.dimension=Vec2d.createFrom(s),"string"==typeof this.map[0]?this.dataType="string":this.dataType="number"),this.index=new Vec2d,this.id=null,this.minView=new Vec2d,this.maxView=this.dimension}setView(t,e){this.minView=Vec2d.createFrom(t),this.maxView=Vec2d.createFrom(e)}render(t){for(let e=this.minView.y;e<this.maxView.y;e++)for(let s=this.minView.x;s<this.maxView.x;s++)this.index=new Vec2d(s,e),this.id=OrthographicMap.getMapId(this,this.index),t()}getID(t){let e=Vec2d.createFrom(t);if("2D"===this.type){if("number"===this.dataType)return this.map[e.y][e.x];if("string"===this.dataType)return this.map[e.y][0][e.x]}else if("1D"===this.type){if("number"===this.dataType)return this.map[e.y*this.dimension.x+e.x];if("string"===this.dataType)return this.map[0][e.y*this.dimension.x+e.x]}}}class OrthographicCamera{constructor(t=new Vec3d,e=new Vec3d){this.pos=Vec3d.createFrom(t),this.dimension=Vec3d.createFrom(e),this.minPos=new Vec3d,this.maxPos=new Vec3d,this._isShaking=!1}lookAt(t,e){let s=Vec3d.createFrom(e);this.pos.z=s.z,this.minPos=this.pos.mult(s.inverse()).applyFunc(Math.floor),this.maxPos=this.pos.add(this.dimension).mult(s.inverse()).applyFunc(Math.ceil)}setMapClamp(t,e){let s=Vec3d.createFrom(t),i=Vec3d.createFrom(e);this.minPos.x<s.x?this.minPos.x=s.x:this.maxPos.x>i.x&&(this.maxPos.x=i.x),this.minPos.y<s.y?this.minPos.y=s.y:this.maxPos.y>i.y&&(this.maxPos.y=i.y)}setPosClamp(t,e){let s=Vec3d.createFrom(t),i=Vec3d.createFrom(e);this.pos.x<s.x?this.pos.x=s.x:this.pos.x+this.dimension.x>i.x&&(this.pos.x=i.x-this.dimension.x),this.pos.y<s.y?this.pos.y=s.y:this.pos.y+this.dimension.y>i.y&&(this.pos.y=i.y-this.dimension.y),this.pos.z<s.z?this.pos.z=s.z:this.pos.z>i.z&&(this.pos.z=i.z)}follow(t,e){if(!this._isShaking){let s=Vec3d.createFrom(t),i=Vec3d.createFrom(e);this.pos=s.add(i.scale(.5)).sub(this.dimension.scale(.5))}}shakeStart(t){this._isShaking=!0;let e=new Vec2d(this.pos.x,this.pos.y);this.pos.x=e.x+Math.sin(10*Math.random())*t,this.pos.y=e.y+Math.cos(10*Math.random())*t}shakeEnd(){this._isShaking=!1}}const Tile={Map:{Orthographic:OrthographicMap},Camera:{Orthographic:OrthographicCamera}};Object.defineProperties(HTMLElement.prototype,{css:{value:function(t){if(!t instanceof Object)throw new Error("CSS Styling data must be an instanceof an Object");for(const e in t)this.style[e]=t[e]}},setCss:{value:function(t,e){this.styles[t]=e}},attr:{value:function(t){if(!t instanceof Object)throw new Error("ATTR data must be an instanceof an Object");for(const e in t)this[e]=t[e]}}});class GameArea{constructor(t,e,s){this.w=t||300,this.h=e||300,this.config=s,this.state=!1,this.section=document.createElement("section"),this.section.style.margin="0",this.state=!1,this._preloadScene=new PreloadScene(this.section,this.w,this.h,this.config),this._mirielleScene=new MirielleScene(this.section,this.w,this.h,s.mirielle),this.section.class="gameScene",this.onReady=null,this._allScenes=[],this.files=[],this._preloadScene.start(),document.body.appendChild(this.section)}getArea(){return this.section}getMedia(t,e="img"){let s=this._preloadScene;if("img"===e||"image"===e){return s._preloadedImages.filter(e=>e.name===t)[0].img}if("aud"===e||"audio"===e){return s._preloadedAudios.filter(e=>e.name===t)[0].aud}if("other"===e||"json"===e){return this._preloadScene._preloadedFiles.filter(e=>e.name===t)[0].res}}animate(){const t=e=>{"function"==typeof this.clear&&"function"==typeof this.update&&(this.clear(),this.update(),requestAnimationFrame(t))};return t}init(){const t=()=>{this._allScenes.forEach(t=>{t instanceof Scene?(this.section.appendChild(t.getCanvas()),t._fpsStarted=performance.now(),t._elapsedTimeStarted=(new Date).getTime(),t.dynamic?requestAnimationFrame(t.animate()):"function"==typeof t.update?t.update():console.error("Scene does not have a valid update method")):this.section.appendChild(t)})};let e=setInterval(()=>{this._mirielleScene.state&&(0!==this.config.preload.length?this._preloadScene.state?(clearInterval(e),this.state=!0,this.files.push(this._preloadScene._preloadedFiles),"function"==typeof this.onReady&&this.onReady(),t()):this._preloadScene.activeScene():(clearInterval(e),this.state=!0,"function"==typeof this.onReady&&this.onReady(),t()))},0)}appendChild(...t){t.forEach(t=>{t instanceof HTMLElement&&this._allScenes.push(t)})}getWidth(){return this.w}getHeight(){return this.h}}class MirielleScene{constructor(t,e,s,i){this._parent=t,this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=s,this._canvas.style.position="absolute",this.state=!1,this._parent.appendChild(this._canvas),this.config=i,this.ctx=this._canvas.getContext("2d");let a=Math.max(5,i.duration||5),n=Math.max(35,i.fontSize)||35,r=Math.max(35,i.fontFamily)||"Verdana";"dark"===this.config.theme?this._canvas.style.backgroundColor="#222":"light"===this.config.theme?this._canvas.style.backgroundColor="#fff":this.config.theme="light",this.ctx.beginPath(),this.ctx.moveTo(e/2,s/2-20);for(let t=0;t<=360;t+=60){let i=t*Math.PI/180,a=3*n,r=e/2+Math.cos(i)*a,h=s/2-20+Math.sin(i)*a;this.ctx.lineTo(r,h)}this.ctx.fillStyle="light"===this.config.theme?"dimgray":"#333",this.ctx.fill(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font=`bold ${n}px ${r}`,this.ctx.fillStyle="light"===this.config.theme?"#fff":"dimgray",this.ctx.fillText("Bat Games",e/2,s/2-20),this.ctx.font=`bold ${n-(n-10)}px ${r}`,this.ctx.fillStyle="red",this.ctx.fillText("Games API for web developers on a GO",e/2,s/2+20),this.ctx.font=`bold 10px ${r}`,this.ctx.fillStyle="light"===this.config.theme?"#222":"#fff",this.ctx.fillText("Mirielle "+(new Date).getFullYear(),e/2,s-50);let h=setTimeout(()=>{clearTimeout(h),this._parent.removeChild(this._canvas),this.state=!0},1e3*a)}}class PreloadScene{constructor(t,e,s,i){if(this.parent=t,this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=s,this._canvas.style.position="absolute",this.state=!1,this.parent.appendChild(this._canvas),this.config=i,this.ctx=this._canvas.getContext("2d"),this.preload=this.config.preload||[],this._preloadedAssetsCounter=0,this._preloadedImages=[],this._preloadedAudios=[],this._preloadedFiles=[],this._preloadAngle=0,this._preloadScale=5,this._preloadColorIndex=0,this._currentLoadingFile="",0!==this.preload.length){let t=[".jpg",".gif",".png"],e=[".mp3"],s=[".txt"];if(!(this.preload instanceof Array))throw TypeError("Failed to initialize preload: Must be an instanceof of an Array");this.preload.forEach((i,a)=>{if(t.some(t=>i.src.endsWith(t))||void 0!==i.type&&"img"===i.type||"image"===i.type)this._preloadedImages.push({img:new Image,ind:a,...i});else if(e.some(t=>i.src.endsWith(t))||void 0!==i.type&&"aud"===i.type||"audio"===i.type)this._preloadedAudios.push({aud:new Audio,ind:a,...i});else{if(!(s.some(t=>i.src.endsWith(t))||void 0!==i.type&&"other"===i.type||"file"===i.type))throw TypeError(`Invalid Media extension for ${i.src}`);this._preloadedFiles.push({type:"file",...i})}})}}start(){const t=()=>{this._preloadedAssetsCounter===this.config.preload.length&&(this.state=!0,this.parent.removeChild(this._canvas))};this._preloadedImages.forEach(e=>{this._currentLoadingFile=e.name,e.img.addEventListener("load",()=>{this._preloadedAssetsCounter++,t()}),e.img.src=e.src}),this._preloadedAudios.forEach(e=>{this._currentLoadingFile=e.name,e.aud.addEventListener("canplaythrough",()=>{this._preloadedAssetsCounter++,t()}),e.aud.src=e.src});const e=(e,s)=>{this._currentLoadingFile=e.name;let i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?(s._preloadedAssetsCounter++,e.res=i.responseText,t()):console.error("Bad Internet Connection: Failed to get "+e.src))},i.open("GET",e.src),i.send()};this._preloadedFiles.forEach(t=>{e(t,this)})}activeScene(){let t=this._canvas.width,e=this._canvas.height;"dark"===this.config.mirielle.theme?this.ctx.fillStyle="#222":this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,t,e);let s=["red","teal","yellow","navy"];this._preloadAngle++;let i=Math.sin(Math.degToRad(this._preloadAngle))*this._preloadScale,a=Math.sin(Math.degToRad(this._preloadAngle))*this._preloadScale;this.ctx.save(),this.ctx.translate(t/2-22.5,e/2-22.5),this.ctx.rotate(Math.degToRad(this._preloadAngle+10)),this.ctx.scale(i,a);for(let t=0;t<2;t++)for(let e=0;e<2;e++){let i=22.5*e-22.5,a=22.5*t-22.5;this.ctx.fillStyle=t<1?s[t+e]:s[Math.min(3,2+e)],this.ctx.fillRect(i,a,17.5,17.5)}this.ctx.restore(),this.ctx.font="bold 13px Verdana",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="dark"===this.config.mirielle.theme?"lightgray":"#222",this.ctx.fillText("Loading..."+this._currentLoadingFile,t/2,e-50),this.ctx.fillText(`${this._preloadedAssetsCounter+1} of ${this.preload.length}`,t/2,e-20)}}class Scene{constructor(t,e=!1){this._parent=t,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this.ctx=this._canvas.getContext("2d"),this.dynamic=e,this._canvas.width=this._parent.w||300,this._canvas.height=this._parent.h||300,this._canvas.class="canvasScene",this.clear=(()=>this.ctx.clearRect(0,0,this._canvas.width,this._canvas.height)),this.update=null,this._fpsStarted=performance.now(),this._elapsedTimeStarted=(new Date).getTime(),this._parent.getArea().appendChild(this._canvas),this._parent._allScenes.push(this)}animate(){const t=e=>{"function"==typeof this.clear&&"function"==typeof this.update&&(this.clear(),this.update(),requestAnimationFrame(t))};return t}getFPS(){let t=performance.now(),e=1e3/(t-this._fpsStarted);return this._fpsStarted=t,e}getElapsedTime(){let t=(new Date).getTime(),e=.001*(t-this._elapsedTimeStarted);return this._elapsedTimeStarted=t,e>.2&&(e=0),e}getContext(){return this._canvas.getContext("2d")}getWidth(){return this._canvas.width}getHeight(){return this._canvas.height}getCanvas(){return this._canvas}getParent(){return this._parent}}window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};const Bat={Core:{init(t){addEventListener("load",()=>{if("function"!=typeof t)throw TypeError("Failed To Initialize Bat: callback must be a function");t()})}},Utils:{randFromArray:t=>t[~~(Math.random()*t.length)],objectToCSSFormat(t){for(let e of t)if(e.charCodeAt()>=65&&e.charCodeAt()<=90){let s=e;t=t.replaceAll(e,`-${s.toLowerCase()}`)}return t}}};